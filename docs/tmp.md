我将把 LangChain 首层 Request 完整结构、树状图、分支说明整理为标准 Markdown 格式，结构清晰、可直接复制到文档中，兼顾专业性和可读性。
LangChain 首层 Request 完整数据结构（Markdown 版）
一、完整树状图


┌─────────────────────────────────────────────────────────────────────────────┐
│  首层 Request（两类核心请求包）                                              │
│  ├─ ModelRequest（给大模型的请求包：用于模型推理、工具选择）                  │
│  └─ ToolCallRequest（给工具的请求包：用于工具执行、结果返回）                 │
└───────────────────────────┬─────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  Request 核心分支（两类 Request 通用基础结构）                               │
│  ├─ runtime（运行时后勤保障中心：提供全流程辅助支撑，核心分支）                │
│  │  ├─ context（自定义业务上下文：用户手动定义的业务数据）                    │
│  │  │  ├─ user_id（自定义属性：用户唯一标识）                                │
│  │  │  ├─ user_name（自定义属性：用户名）                                    │
│  │  │  └─ ...（可选自定义属性：手机号、用户等级等业务字段）                   │
│  │  ├─ store（内置数据存储仓库：读写历史数据、持久化快照）                    │
│  │  │  ├─ get()（读取数据：按 Key 获取存储内容，如用户偏好）                  │
│  │  │  ├─ set()（写入数据：按 Key 存储/更新内容，持久化关键信息）             │
│  │  │  ├─ delete()（删除数据：清理无效冗余存储内容）                          │
│  │  │  └─ keys()（查询 Key 列表：获取所有已存储数据的标识）                   │
│  │  ├─ agent_state（完整会话状态档案：LangChain 内置，还原会话全貌）          │
│  │  │  ├─ messages（会话消息列表：分类型存储交互内容）                        │
│  │  │  │  ├─ HumanMessage（用户输入消息）                                    │
│  │  │  │  ├─ AIMessage（AI 回复消息）                                       │
│  │  │  │  ├─ ToolMessage（工具执行返回消息）                                 │
│  │  │  │  └─ SystemMessage（系统提示消息：约束 AI 行为）                      │
│  │  │  ├─ intermediate_steps（工具调用历史：完整执行轨迹台账）                │
│  │  │  │  ├─ tool_name（调用的工具名称）                                     │
│  │  │  │  ├─ tool_args（工具调用参数）                                       │
│  │  │  │  ├─ tool_result（工具执行结果）                                     │
│  │  │  │  └─ execute_time（执行时间戳）                                       │
│  │  │  ├─ metadata（会话元数据：辅助信息）                                   │
│  │  │  │  ├─ session_id（会话唯一标识）                                      │
│  │  │  │  ├─ model_version（使用的大模型版本，如 gpt-4o）                    │
│  │  │  │  ├─ create_time（会话创建时间）                                      │
│  │  │  │  └─ last_update_time（会话最后更新时间）                            │
│  │  │  └─ status（会话状态标识：简化标签）                                   │
│  │  │     ├─ running（运行中：执行模型推理/工具调用）                        │
│  │  │     ├─ succeeded（执行成功：返回有效结果）                              │
│  │  │     ├─ failed（执行失败：出现错误无法返回有效结果）                      │
│  │  │     └─ timeout（执行超时：超出预设时间被迫终止）                        │
│  │  ├─ config（内置运行时全局配置：引擎默认规则，无需手动修改）                │
│  │  │  ├─ timeout（全局超时时间：模型/工具执行最大允许时长）                  │
│  │  │  ├─ max_retries（最大重试次数：执行失败后的自动重试次数）                │
│  │  │  ├─ temperature（模型温度：控制 AI 回复随机性，仅 ModelRequest 有效）    │
│  │  │  └─ tool_whitelist（工具白名单：限制可调用的工具范围）                  │
│  │  └─ logger（内置日志工具：输出运行日志，用于排查问题）                     │
│  │     ├─ info()（信息日志：记录正常执行流程）                                │
│  │     ├─ warning()（警告日志：记录非致命问题，如存储数据为空）                │
│  │     ├─ error()（错误日志：记录致命问题，如工具调用失败）                    │
│  │     └─ debug()（调试日志：记录详细执行细节，仅开发环境生效）                │
│  │                                                                           │
│  ├─ tool_call / tools（工具相关分支：两类 Request 差异化实现）                │
│  │  ├─ ModelRequest：tools（可用工具列表：大模型可选择调用的工具清单）         │
│  │  └─ ToolCallRequest：tool_call（具体工具调用信息：工具名、参数等）         │
│  │                                                                           │
│  ├─ input（核心输入数据：大模型/工具需处理的核心任务内容）                    │
│  │  ├─ ModelRequest：prompt/context_messages（提示词+历史会话上下文）         │
│  │  └─ ToolCallRequest：task（具体任务描述：辅助工具理解执行目标）            │
│  │                                                                           │
│  ├─ metadata（请求元数据：请求身份标签，辅助管理追踪）                        │
│  │  ├─ request_id（请求唯一标识：用于追踪排查问题）                            │
│  │  ├─ create_time（请求创建时间戳）                                          │
│  │  ├─ request_type（请求类型：model / tool）                                 │
│  │  └─ source（请求来源：Agent 自动触发 / 手动触发）                          │
│  │                                                                           │
│  └─ config（请求专属配置：个性化参数，优先级高于 runtime 全局配置）            │
│     ├─ timeout（专属超时时间：覆盖全局超时规则）                             │
│     ├─ max_tokens（模型生成最大令牌数：仅 ModelRequest 有效）                 │
│     └─ return_raw_result（是否返回原始结果：仅 ToolCallRequest 有效）         │
└─────────────────────────────────────────────────────────────────────────────┘


二、核心说明（大白话版）
1. 首层 Request 整体定位
Request 是 LangChain Agent 发起的「完整任务通知单」，分为两类：ModelRequest 面向大模型（下达思考、选工具的指令），ToolCallRequest 面向工具（下达具体执行任务的指令）。二者共享基础分支结构，仅在工具相关分支上有差异化实现。
2. 核心分支解读（按重要性排序）
（1）runtime 分支
核心「后勤保障中心」，为大模型 / 工具执行提供全流程辅助支撑，包含自定义业务数据、内置资源、状态档案等，是 Request 中最关键的辅助分支。
（2）tool_call /tools 分支
工具专属指令分支，差异化适配两类 Request：
ModelRequest：tools 是大模型的「工具菜单」，明确可调用的工具范围；
ToolCallRequest：tool_call 是工具的「任务详情单」，明确工具名、参数等执行信息。
（3）input 分支
请求的「核心干货」，存储大模型 / 工具需处理的核心内容，是任务执行的核心目标。
（4）metadata 分支
请求的「身份标签」，仅用于辅助管理和问题追踪，不影响核心业务逻辑。
（5）config 分支（请求专属）
请求的「个性化参数」，可覆盖 runtime 中的全局配置，满足不同请求的差异化需求（如个别工具需延长超时时间）。
3. 关键结论
首层 Request 并非仅含 runtime 分支，而是由「辅助支撑（runtime）+ 工具指令 + 核心输入 + 身份标签 + 个性化配置」共同构成的完整包，各分支协同支撑大模型 / 工具高效、灵活执行任务。
